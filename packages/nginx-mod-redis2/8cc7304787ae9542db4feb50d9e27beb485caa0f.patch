From 8cc7304787ae9542db4feb50d9e27beb485caa0f Mon Sep 17 00:00:00 2001
From: "Charles R. Portwood II" <charlesportwoodii@erianna.com>
Date: Tue, 15 Nov 2016 10:49:45 -0600
Subject: [PATCH] feature: fixed compilation errors with Nginx 1.11.6.

`default_port` is no longer defined in `ngx_http_upstream_srv_conf_s` as of 1.11.6.
This simplistic patch checks excludes use of the `default_port` in 1.11.6 and higher.

Signed-off-by: Yichun Zhang (agentzh) <agentzh@gmail.com>
---
 src/ngx_http_redis2_util.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/ngx_http_redis2_util.c b/src/ngx_http_redis2_util.c
index d7a34d6..5dc12fb 100644
--- a/src/ngx_http_redis2_util.c
+++ b/src/ngx_http_redis2_util.c
@@ -77,6 +77,7 @@ ngx_http_redis2_upstream_add(ngx_http_request_t *r, ngx_url_t *url)
             continue;
         }
 
+#if (nginx_version < 1011006)
         if (uscfp[i]->default_port
             && url->default_port
             && uscfp[i]->default_port != url->default_port)
@@ -84,6 +85,7 @@ ngx_http_redis2_upstream_add(ngx_http_request_t *r, ngx_url_t *url)
             dd("upstream_add: default_port not match");
             continue;
         }
+#endif
 
         return uscfp[i];
     }
